---
title: "事例: 2017年総選挙に関するツイート"
author: Kohei Watanabe and Akitaka Matsuo
output: 
  html_document:
    toc: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "##"
)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## パッケージの読み込み
```{r, message = FALSE}
devtools::install_github("quanteda/quanteda.data")
library(quanteda)
library(quanteda.data)
```


## 安倍晋三についてツイッターコーパスをダウンロード
等で
```{r}
corp <- data_download(url = 'https://www.dropbox.com/s/co12wpj08pzqz71/data_corpus_election2017tweets.rds?dl=1')

texts(corp) <- stringi::stri_trans_nfkc(texts(corp))


```


## 投稿の数と期間を取得
```{r}
ndoc(corp)
range(docvars(corp, 'created_at'))
```


# 前処理

## 語の分割と結合

```{r}

toks <- tokens(corp, remove_separator = FALSE, remove_url = TRUE)
toks <- tokens_remove(toks, '^[\\b\\s]+$', valuetype = 'regex', padding = TRUE)
toks <- tokens_select(toks, '^[\\w#@]+$', valuetype = 'regex', padding = TRUE)

min_count <- 10

toks_kana <- tokens_keep(toks, '^[ァ-ヶー]+$', valuetype = 'regex', padding = TRUE)
col_kana <- textstat_collocations(toks_kana, min_count = min_count, size = 2)
toks <- tokens_compound(toks, col_kana[col_kana$z > 3,], concatenator = '')

toks_kanji <- tokens_keep(toks, '^[一-龠]+$', valuetype = 'regex', padding = TRUE)
col_kanji <- textstat_collocations(toks_kanji, min_count = min_count, size = 2)
toks <- tokens_compound(toks, col_kanji[col_kanji$z > 3,], concatenator = '')


toks_any <- tokens_select(toks, '^[0-9ァ-ヶー一-龠]+$', valuetype = 'regex', padding = TRUE)
col_any <- textstat_collocations(toks_any, min_count = min_count)
toks <- tokens_compound(toks, col_any[col_any$z > 3,], concatenator = '')

mt <- dfm(toks)
```

```{r}
mt_tag <- dfm_select(mt, '#*')
mt_tag <- dfm_remove(mt_tag, c('*選挙*', '*衆院選*', '*衆議院*', '*投票*'))

mt_tag <- dfm_select(mt_tag, min_nchar = 2)
mt_tag <- dfm_trim(mt_tag, min_count = 10)
mt_co <- fcm(mt_tag)
feat <- names(topfeatures(mt_co, 100))
textplot_network(fcm_select(mt_co,  feat), min_freq = 0.8)
```

```{r}

mt_msg <- dfm_remove(mt, c('#*', '@*'))
mt_msg <- dfm_toupper(mt_msg)
mt_msg <- dfm_remove(mt_msg, '^[ぁ-ん]+$', 'regex')

mt_msg <- dfm_select(mt_msg, min_nchar = 2)
mt_msg <- dfm_trim(mt_msg, min_count = 10)
mt_co <- fcm(mt_msg)
feat <- names(topfeatures(mt_co, 50))
textplot_network(fcm_select(mt_co,  feat), min_freq = 0.3)

```


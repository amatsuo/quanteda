<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replication of Chapter 5 of <em>Quantitative Social Science: An Introduction</em> • quanteda</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../../../pkgdown.css" rel="stylesheet">
<script src="../../../jquery.sticky-kit.min.js"></script><script src="../../../pkgdown.js"></script><link href="../../../extra.css" rel="stylesheet">
<script src="../../../extra.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-144616-24', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../index.html">Quanteda</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Quick Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/quickstart_cn.html">快速入门指南</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/quickstart_ja.html">クイック・スタートガイド</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../../articles/pkgdown/comparison.html">Features</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/examples/phrase.html">Multi-word expressions</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/plotting.html">Textual data visualization</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/lsa.html">Latent Semantic Analysis (LSA)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/chinese.html">Chinese text analysis</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/twitter.html">Social media analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Replications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/replication/digital-humanities.html">Text Analysis with R for Students of Literature</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/text2vec.html">Word embedding (word2vec)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/qss.html">_Quantitative Social Science_ Ch. 5.1</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../articles/design.html">Design</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/quanteda/quanteda">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Replication of Chapter 5 of <em>Quantitative Social Science: An Introduction</em>
</h1>
                        <h4 class="author">Stefan Müller and Kenneth Benoit</h4>
            
          </div>

    
    
<div class="contents">
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><div class="sourceLine" id="cb1-1" data-line-number="1">
<span class="kw">library</span>(quanteda)</div></code></pre>
<p>In this vignette we show how the <strong>quanteda</strong> package can be used to replicate the text analysis part (Chapter 5.1) from Kosuke Imai’s book <a href="http://qss.princeton.press"><em>Quantitative Social Science: An Introduction</em></a> (Princeton: Princeton University Press, 2017).</p>
<section id="download-the-corpus" class="level2"><h2>Download the corpus</h2>
<p>To get the textual data, you need to install and load the <strong>qss</strong> package first that comes with the book.</p>
<pre class="sourceCode r" id="cb2"><code class="sourceCode r"><div class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"kosukeimai/qss-package"</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</div></code></pre>
</section><section id="section-5.1.1-the-disputed-authorship-of-the-federalist-papers" class="level2"><h2>Section 5.1.1: The Disputed Authorship of ‘The Federalist Papers’</h2>
<p>First, we use the <strong>readtext</strong> package to import the Federalist Papers as a data frame and create a <strong>quanteda</strong> corpus.</p>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><div class="sourceLine" id="cb3-1" data-line-number="1">
<span class="kw">library</span>(readtext)</div>
<div class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># use readtext package to import all documents as a dataframe</span></div>
<div class="sourceLine" id="cb3-3" data-line-number="3">corpus_texts &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readtext/topics/readtext">readtext</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata/federalist/"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>))</div>
<div class="sourceLine" id="cb3-4" data-line-number="4"></div>
<div class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># create docvar with number of paper</span></div>
<div class="sourceLine" id="cb3-6" data-line-number="6">corpus_texts<span class="op">$</span>paper_number &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">"No."</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(corpus_texts), <span class="dt">sep =</span> <span class="st">" "</span>)</div>
<div class="sourceLine" id="cb3-7" data-line-number="7"></div>
<div class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># transform to a quanteda corpus object</span></div>
<div class="sourceLine" id="cb3-9" data-line-number="9">corpus_raw &lt;-<span class="st"> </span><span class="kw"><a href="../../../reference/corpus.html">corpus</a></span>(corpus_texts, <span class="dt">text_field =</span> <span class="st">"text"</span>, <span class="dt">docid_field =</span> <span class="st">"paper_number"</span>)</div></code></pre>
<pre class="sourceCode r" id="cb4"><code class="sourceCode r"><div class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># inspect Paper No. 10 (output suppressed)</span></div>
<div class="sourceLine" id="cb4-2" data-line-number="2">
<span class="kw"><a href="../../../reference/texts.html">texts</a></span>(corpus_raw)[<span class="dv">10</span>] <span class="op">%&gt;%</span><span class="st"> </span>
</div>
<div class="sourceLine" id="cb4-3" data-line-number="3">
<span class="st">    </span>stringi<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringi/topics/stri_sub">stri_sub</a></span>(<span class="dv">1</span>, <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
</div>
<div class="sourceLine" id="cb4-4" data-line-number="4">
<span class="st">    </span><span class="kw">cat</span>()</div></code></pre>
</section><section id="section-5.1.2-document-term-matrix" class="level2"><h2>Section 5.1.2: Document-Term Matrix</h2>
<p>Next, we transform the corpus to a document-feature matrix. <code>dfm_prep</code> (used in sections 5.1.4 and 5.1.5) is a dfm in which numbers and punctuation have been removed, and in which terms have been converted to lowercase. In <code>dfm_papers</code>, the words have also been stemmed and a standard set of stopwords removed.</p>
<pre class="sourceCode r" id="cb5"><code class="sourceCode r"><div class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># transform corpus to a document-feature matrix</span></div>
<div class="sourceLine" id="cb5-2" data-line-number="2">dfm_prep &lt;-<span class="st"> </span><span class="kw"><a href="../../../reference/dfm.html">dfm</a></span>(corpus_raw, <span class="dt">remove_numbers =</span> <span class="ot">TRUE</span>, <span class="dt">tolower =</span> <span class="ot">TRUE</span>,</div>
<div class="sourceLine" id="cb5-3" data-line-number="3">                 <span class="dt">remove_punct =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</div></code></pre>
<pre><code>## Creating a dfm from a corpus input...</code></pre>
<pre><code>##    ... lowercasing</code></pre>
<pre><code>##    ... found 85 documents, 8,630 features</code></pre>
<pre><code>##    ... created a 85 x 8,630 sparse dfm
##    ... complete. 
## Elapsed time: 0.32 seconds.</code></pre>
<pre class="sourceCode r" id="cb10"><code class="sourceCode r"><div class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># remove stop words and stem words</span></div>
<div class="sourceLine" id="cb10-2" data-line-number="2">dfm_papers &lt;-<span class="st"> </span><span class="kw"><a href="../../../reference/dfm.html">dfm</a></span>(dfm_prep, <span class="dt">stem =</span> <span class="ot">TRUE</span>, <span class="dt">remove =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stopwords/topics/stopwords">stopwords</a></span>(<span class="st">"english"</span>))</div>
<div class="sourceLine" id="cb10-3" data-line-number="3"></div>
<div class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># inspect some documents in the dfm</span></div>
<div class="sourceLine" id="cb10-5" data-line-number="5">
<span class="kw">head</span>(dfm_papers, <span class="dt">nf =</span> <span class="dv">8</span>)</div></code></pre>
<pre><code>## Document-feature matrix of: 6 documents, 8 features (50% sparse).
## 6 x 8 sparse Matrix of class "dfm"
##        features
## docs    unequivoc experi ineffici subsist feder govern call upon
##   No. 1         1      1        1       1     1      9    1    6
##   No. 2         0      3        0       0     2      9    1    1
##   No. 3         0      1        0       0     2     20    0    0
##   No. 4         0      2        0       0     0     21    1    0
##   No. 5         0      1        0       0     0      3    0    0
##   No. 6         0      3        0       0     0      4    0    4</code></pre>
</section><section id="section-5.1.3-topic-discovery" class="level2"><h2>Section 5.1.3: Topic Discovery</h2>
<p>We can use the <code><a href="../../../reference/textplot_wordcloud.html">textplot_wordcloud()</a></code> function to plot word clouds of the most frequent words in Papers 12 and 24.</p>
<pre class="sourceCode r" id="cb12"><code class="sourceCode r"><div class="sourceLine" id="cb12-1" data-line-number="1">
<span class="kw">set.seed</span>(<span class="dv">100</span>)</div>
<div class="sourceLine" id="cb12-2" data-line-number="2">
<span class="kw"><a href="../../../reference/textplot_wordcloud.html">textplot_wordcloud</a></span>(dfm_papers[<span class="st">"No. 12"</span>, ], <span class="dt">max.words =</span> <span class="dv">20</span>)</div></code></pre>
<p><img src="qss_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<pre class="sourceCode r" id="cb13"><code class="sourceCode r"><div class="sourceLine" id="cb13-1" data-line-number="1">
<span class="kw"><a href="../../../reference/textplot_wordcloud.html">textplot_wordcloud</a></span>(dfm_papers[<span class="st">"No. 24"</span>, ], <span class="dt">max.words =</span> <span class="dv">20</span>)</div></code></pre>
<p><img src="qss_files/figure-html/unnamed-chunk-7-2.png" width="768"></p>
<p>Next, we identify clusters of similar essay based on term frequency-inverse document frequency (<em>tf-idf</em>) and apply the <span class="math inline">\(k\)</span>-means algorithm to the weighted dfm.</p>
<pre class="sourceCode r" id="cb14"><code class="sourceCode r"><div class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># tf-idf calculation</span></div>
<div class="sourceLine" id="cb14-2" data-line-number="2">dfm_papers_tfidf &lt;-<span class="st"> </span><span class="kw"><a href="../../../reference/dfm_tfidf.html">dfm_tfidf</a></span>(dfm_papers, <span class="dt">base =</span> <span class="dv">2</span>)</div>
<div class="sourceLine" id="cb14-3" data-line-number="3"></div>
<div class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"># 10 most important words for Paper No. 12</span></div>
<div class="sourceLine" id="cb14-5" data-line-number="5">
<span class="kw"><a href="../../../reference/textstat_frequency.html">textstat_frequency</a></span>(dfm_papers_tfidf[<span class="dv">12</span>], <span class="dt">n =</span> <span class="dv">10</span>)</div></code></pre>
<pre><code>##       feature frequency rank docfreq group
## 1      revenu  19.42088    1       1   all
## 2      patrol  19.22817    2       1   all
## 3  contraband  19.22817    3       1   all
## 4       excis  19.12214    4       1   all
## 5       coast  16.22817    5       1   all
## 6       trade  15.01500    6       1   all
## 7         per  14.47329    7       1   all
## 8         tax  13.20080    8       1   all
## 9        cent  12.81878    9       1   all
## 10     gallon  12.81878   10       1   all</code></pre>
<pre class="sourceCode r" id="cb16"><code class="sourceCode r"><div class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># 10 most important words for Paper No. 24</span></div>
<div class="sourceLine" id="cb16-2" data-line-number="2">
<span class="kw"><a href="../../../reference/textstat_frequency.html">textstat_frequency</a></span>(dfm_papers_tfidf[<span class="dv">24</span>], <span class="dt">n =</span> <span class="dv">10</span>)</div></code></pre>
<pre><code>##       feature frequency rank docfreq group
## 1    garrison 24.524777    1       1   all
## 2   dock-yard 19.228173    2       1   all
## 3  settlement 16.228173    3       1   all
## 4       spain 13.637564    4       1   all
## 5        armi 12.770999    5       1   all
## 6    frontier 12.262389    6       1   all
## 7     arsenal 10.818782    7       1   all
## 8     western 10.806108    8       1   all
## 9        post 10.228173    9       1   all
## 10     nearer  9.648857   10       1   all</code></pre>
<pre class="sourceCode r" id="cb18"><code class="sourceCode r"><div class="sourceLine" id="cb18-1" data-line-number="1">k &lt;-<span class="st"> </span><span class="dv">4</span>  <span class="co"># number of clusters</span>
</div>
<div class="sourceLine" id="cb18-2" data-line-number="2"></div>
<div class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># subset The Federalist papers written by Hamilton</span></div>
<div class="sourceLine" id="cb18-4" data-line-number="4">hamilton &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">9</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">13</span>, <span class="dv">15</span><span class="op">:</span><span class="dv">17</span>, <span class="dv">21</span><span class="op">:</span><span class="dv">36</span>, <span class="dv">59</span><span class="op">:</span><span class="dv">61</span>, <span class="dv">65</span><span class="op">:</span><span class="dv">85</span>)</div>
<div class="sourceLine" id="cb18-5" data-line-number="5"></div>
<div class="sourceLine" id="cb18-6" data-line-number="6">dfm_papers_tfidf_hamilton &lt;-<span class="st"> </span>dfm_papers_tfidf[hamilton, ]</div>
<div class="sourceLine" id="cb18-7" data-line-number="7"></div>
<div class="sourceLine" id="cb18-8" data-line-number="8"><span class="co"># run k-means</span></div>
<div class="sourceLine" id="cb18-9" data-line-number="9">km_out &lt;-<span class="st"> </span><span class="kw">kmeans</span>(dfm_papers_tfidf_hamilton, <span class="dt">centers =</span> k)</div>
<div class="sourceLine" id="cb18-10" data-line-number="10"></div>
<div class="sourceLine" id="cb18-11" data-line-number="11">km_out<span class="op">$</span>iter <span class="co"># check the convergence; number of iterations may vary</span>
</div></code></pre>
<pre><code>## [1] 5</code></pre>
<pre class="sourceCode r" id="cb20"><code class="sourceCode r"><div class="sourceLine" id="cb20-1" data-line-number="1">
<span class="kw">colnames</span>(km_out<span class="op">$</span>centers) &lt;-<span class="st"> </span><span class="kw"><a href="../../../reference/featnames.html">featnames</a></span>(dfm_papers_tfidf_hamilton)</div>
<div class="sourceLine" id="cb20-2" data-line-number="2"></div>
<div class="sourceLine" id="cb20-3" data-line-number="3">
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k) { <span class="co"># loop for each cluster</span>
</div>
<div class="sourceLine" id="cb20-4" data-line-number="4">  <span class="kw">cat</span>(<span class="st">"CLUSTER"</span>, i, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</div>
<div class="sourceLine" id="cb20-5" data-line-number="5">  <span class="kw">cat</span>(<span class="st">"Top 10 words:</span><span class="ch">\n</span><span class="st">"</span>) <span class="co"># 10 most important terms at the centroid</span>
</div>
<div class="sourceLine" id="cb20-6" data-line-number="6">  <span class="kw">print</span>(<span class="kw">head</span>(<span class="kw">sort</span>(km_out<span class="op">$</span>centers[i, ], <span class="dt">decreasing =</span> <span class="ot">TRUE</span>), <span class="dt">n =</span> <span class="dv">10</span>))</div>
<div class="sourceLine" id="cb20-7" data-line-number="7">  <span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</div>
<div class="sourceLine" id="cb20-8" data-line-number="8">  <span class="kw">cat</span>(<span class="st">"Federalist Papers classified: </span><span class="ch">\n</span><span class="st">"</span>) <span class="co"># extract essays classified</span>
</div>
<div class="sourceLine" id="cb20-9" data-line-number="9">  <span class="kw">print</span>(<span class="kw">rownames</span>(dfm_papers_tfidf_hamilton)[km_out<span class="op">$</span>cluster <span class="op">==</span><span class="st"> </span>i])</div>
<div class="sourceLine" id="cb20-10" data-line-number="10">  <span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</div>
<div class="sourceLine" id="cb20-11" data-line-number="11">}</div></code></pre>
<pre><code>## CLUSTER 1 
## Top 10 words:
##       juri      trial      court     crimin  admiralti     equiti 
##  218.20102   84.74567   62.47940   42.06871   40.87463   38.24428 
##   chanceri     probat common-law      civil 
##   37.86574   27.04695   27.04695   26.77843 
## 
## Federalist Papers classified: 
## [1] "No. 83"
## 
## CLUSTER 2 
## Top 10 words:
##     court     appel jurisdict    suprem      juri    tribun    cogniz 
##  69.68857  35.27513  25.46591  24.79126  22.16104  21.27125  19.12214 
##  inferior    appeal re-examin 
##  18.76875  16.21098  13.52348 
## 
## Federalist Papers classified: 
## [1] "No. 81" "No. 82"
## 
## CLUSTER 3 
## Top 10 words:
##    senat     upon     armi    court    claus   presid     land      tax 
## 3.630311 3.597576 2.639599 2.624612 2.523957 2.249028 2.206821 2.206821 
##  militia   revenu 
## 2.103774 2.103616 
## 
## Federalist Papers classified: 
##  [1] "No. 1"  "No. 6"  "No. 7"  "No. 8"  "No. 9"  "No. 11" "No. 12"
##  [8] "No. 13" "No. 15" "No. 16" "No. 17" "No. 21" "No. 22" "No. 23"
## [15] "No. 24" "No. 25" "No. 26" "No. 27" "No. 28" "No. 29" "No. 30"
## [22] "No. 31" "No. 32" "No. 33" "No. 34" "No. 35" "No. 36" "No. 59"
## [29] "No. 60" "No. 61" "No. 65" "No. 66" "No. 67" "No. 68" "No. 70"
## [36] "No. 71" "No. 72" "No. 73" "No. 74" "No. 75" "No. 76" "No. 77"
## [43] "No. 78" "No. 79" "No. 80" "No. 84" "No. 85"
## 
## CLUSTER 4 
## Top 10 words:
## governor   presid     king     york  treason  adjourn   pardon   treati 
## 70.79902 33.82538 30.18507 24.81755 22.04695 21.63756 20.43731 16.02036 
##  britain  resembl 
## 15.50330 13.63756 
## 
## Federalist Papers classified: 
## [1] "No. 69"</code></pre>
</section><section id="section-5.1.4-authorship-prediction" class="level2"><h2>Section 5.1.4: Authorship Prediction</h2>
<p>In a next step, we want to predict authorship for the Federalist Papers whose authorship is unknown. As the topics of the Papers differs remarkably, Imai focuses on 10 articles, prepositions and conjunctions to predicte authorship.</p>
<pre class="sourceCode r" id="cb22"><code class="sourceCode r"><div class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># document-term matrix converted to matrix for manipulation</span></div>
<div class="sourceLine" id="cb22-2" data-line-number="2">dtm1 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dfm_prep)</div>
<div class="sourceLine" id="cb22-3" data-line-number="3"></div>
<div class="sourceLine" id="cb22-4" data-line-number="4"><span class="co"># term frequency per 1000 words</span></div>
<div class="sourceLine" id="cb22-5" data-line-number="5">tfm &lt;-<span class="st"> </span>dtm1 <span class="op">/</span><span class="st"> </span><span class="kw">rowSums</span>(dtm1) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> </div>
<div class="sourceLine" id="cb22-6" data-line-number="6"></div>
<div class="sourceLine" id="cb22-7" data-line-number="7"><span class="co"># words of interest</span></div>
<div class="sourceLine" id="cb22-8" data-line-number="8">words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"although"</span>, <span class="st">"always"</span>, <span class="st">"commonly"</span>, <span class="st">"consequently"</span>,</div>
<div class="sourceLine" id="cb22-9" data-line-number="9">           <span class="st">"considerable"</span>, <span class="st">"enough"</span>, <span class="st">"there"</span>, <span class="st">"upon"</span>, <span class="st">"while"</span>, <span class="st">"whilst"</span>)</div>
<div class="sourceLine" id="cb22-10" data-line-number="10">tfm &lt;-<span class="st"> </span>tfm[, words]</div>
<div class="sourceLine" id="cb22-11" data-line-number="11"></div>
<div class="sourceLine" id="cb22-12" data-line-number="12"><span class="co"># essays written by Madison: 'hamilton' defined earlier</span></div>
<div class="sourceLine" id="cb22-13" data-line-number="13">madison &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">14</span>, <span class="dv">37</span><span class="op">:</span><span class="dv">48</span>, <span class="dv">58</span>)</div>
<div class="sourceLine" id="cb22-14" data-line-number="14"></div>
<div class="sourceLine" id="cb22-15" data-line-number="15"><span class="co"># average among Hamilton/Madison essays</span></div>
<div class="sourceLine" id="cb22-16" data-line-number="16">tfm_ave &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">colSums</span>(tfm[hamilton, ]) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(hamilton),</div>
<div class="sourceLine" id="cb22-17" data-line-number="17">                 <span class="kw">colSums</span>(tfm[madison, ]) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(madison))</div>
<div class="sourceLine" id="cb22-18" data-line-number="18"></div>
<div class="sourceLine" id="cb22-19" data-line-number="19">author &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(tfm)) <span class="co"># a vector with missing values</span>
</div>
<div class="sourceLine" id="cb22-20" data-line-number="20">author[hamilton] &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co"># 1 if Hamilton</span>
</div>
<div class="sourceLine" id="cb22-21" data-line-number="21">author[madison] &lt;-<span class="st"> </span><span class="dv">-1</span>  <span class="co"># -1 if Madison</span>
</div>
<div class="sourceLine" id="cb22-22" data-line-number="22"></div>
<div class="sourceLine" id="cb22-23" data-line-number="23"><span class="co"># data frame for regression</span></div>
<div class="sourceLine" id="cb22-24" data-line-number="24">author_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">author =</span> author[<span class="kw">c</span>(hamilton, madison)],</div>
<div class="sourceLine" id="cb22-25" data-line-number="25">                          tfm[<span class="kw">c</span>(hamilton, madison), ])</div>
<div class="sourceLine" id="cb22-26" data-line-number="26"></div>
<div class="sourceLine" id="cb22-27" data-line-number="27">hm_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(author <span class="op">~</span><span class="st"> </span>upon <span class="op">+</span><span class="st"> </span>there <span class="op">+</span><span class="st"> </span>consequently <span class="op">+</span><span class="st"> </span>whilst,</div>
<div class="sourceLine" id="cb22-28" data-line-number="28">             <span class="dt">data =</span> author_data)</div>
<div class="sourceLine" id="cb22-29" data-line-number="29">hm_fit</div></code></pre>
<pre><code>## 
## Call:
## lm(formula = author ~ upon + there + consequently + whilst, data = author_data)
## 
## Coefficients:
##  (Intercept)          upon         there  consequently        whilst  
##      -0.2729        0.2240        0.1278       -0.5596       -0.8378</code></pre>
<pre class="sourceCode r" id="cb24"><code class="sourceCode r"><div class="sourceLine" id="cb24-1" data-line-number="1">hm_fitted &lt;-<span class="st"> </span><span class="kw">fitted</span>(hm_fit) <span class="co"># fitted values</span>
</div>
<div class="sourceLine" id="cb24-2" data-line-number="2">
<span class="kw">sd</span>(hm_fitted)</div></code></pre>
<pre><code>## [1] 0.7175527</code></pre>
</section><section id="section-5.1.5-cross-validation" class="level2"><h2>Section 5.1.5: Cross-Validation</h2>
<p>Finally, we assess how well the model fits the data by classifying each essay based on its fitted value.</p>
<pre class="sourceCode r" id="cb26"><code class="sourceCode r"><div class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># proportion of correctly classified essays by Hamilton</span></div>
<div class="sourceLine" id="cb26-2" data-line-number="2">
<span class="kw">mean</span>(hm_fitted[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</div></code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r" id="cb28"><code class="sourceCode r"><div class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># proportion of correctly classified essays by Madison</span></div>
<div class="sourceLine" id="cb28-2" data-line-number="2">
<span class="kw">mean</span>(hm_fitted[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</div></code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r" id="cb30"><code class="sourceCode r"><div class="sourceLine" id="cb30-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(author_data)</div>
<div class="sourceLine" id="cb30-2" data-line-number="2">hm_classify &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n) <span class="co"># a container vector with missing values</span>
</div>
<div class="sourceLine" id="cb30-3" data-line-number="3"></div>
<div class="sourceLine" id="cb30-4" data-line-number="4">
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</div>
<div class="sourceLine" id="cb30-5" data-line-number="5">  <span class="co"># fit the model to the data after removing the ith observation</span>
</div>
<div class="sourceLine" id="cb30-6" data-line-number="6">  sub_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(author <span class="op">~</span><span class="st"> </span>upon <span class="op">+</span><span class="st"> </span>there <span class="op">+</span><span class="st"> </span>consequently <span class="op">+</span><span class="st"> </span>whilst,</div>
<div class="sourceLine" id="cb30-7" data-line-number="7">                <span class="dt">data =</span> author_data[<span class="op">-</span>i, ]) <span class="co"># exclude ith row</span>
</div>
<div class="sourceLine" id="cb30-8" data-line-number="8">  <span class="co"># predict the authorship for the ith observation</span>
</div>
<div class="sourceLine" id="cb30-9" data-line-number="9">  hm_classify[i] &lt;-<span class="st"> </span><span class="kw">predict</span>(sub_fit, <span class="dt">newdata =</span> author_data[i, ])</div>
<div class="sourceLine" id="cb30-10" data-line-number="10">}</div>
<div class="sourceLine" id="cb30-11" data-line-number="11"></div>
<div class="sourceLine" id="cb30-12" data-line-number="12"><span class="co"># proportion of correctly classified essays by Hamilton</span></div>
<div class="sourceLine" id="cb30-13" data-line-number="13">
<span class="kw">mean</span>(hm_classify[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</div></code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r" id="cb32"><code class="sourceCode r"><div class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># proportion of correctly classified essays by Madison</span></div>
<div class="sourceLine" id="cb32-2" data-line-number="2">
<span class="kw">mean</span>(hm_classify[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</div></code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="sourceCode r" id="cb34"><code class="sourceCode r"><div class="sourceLine" id="cb34-1" data-line-number="1">disputed &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">49</span>, <span class="dv">50</span><span class="op">:</span><span class="dv">57</span>, <span class="dv">62</span>, <span class="dv">63</span>) <span class="co"># 11 essays with disputed authorship</span>
</div>
<div class="sourceLine" id="cb34-2" data-line-number="2">tf_disputed &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(dtm1[disputed, ])</div>
<div class="sourceLine" id="cb34-3" data-line-number="3"></div>
<div class="sourceLine" id="cb34-4" data-line-number="4"><span class="co"># prediction of disputed authorship</span></div>
<div class="sourceLine" id="cb34-5" data-line-number="5">pred &lt;-<span class="st"> </span><span class="kw">predict</span>(hm_fit, <span class="dt">newdata =</span> tf_disputed)</div>
<div class="sourceLine" id="cb34-6" data-line-number="6"></div>
<div class="sourceLine" id="cb34-7" data-line-number="7">pred <span class="co"># predicted values</span>
</div></code></pre>
<pre><code>##      No. 49      No. 50      No. 51      No. 52      No. 53      No. 54 
## -1.41472721 -0.04889739 -2.55659890 -0.27285552 -0.85511475 -0.81637448 
##      No. 55      No. 56      No. 57      No. 62      No. 63 
##  0.36609304 -0.72732503 -2.27521263 -1.95169291 -0.08837647</code></pre>
<pre class="sourceCode r" id="cb36"><code class="sourceCode r"><div class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># plot the fitted values for each Federalist paper</span></div>
<div class="sourceLine" id="cb36-2" data-line-number="2"></div>
<div class="sourceLine" id="cb36-3" data-line-number="3">
<span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.25</span>)</div>
<div class="sourceLine" id="cb36-4" data-line-number="4"><span class="co"># fitted values for essays authored by Hamilton; red squares</span></div>
<div class="sourceLine" id="cb36-5" data-line-number="5">
<span class="kw">plot</span>(hamilton, hm_fitted[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">1</span>], <span class="dt">pch =</span> <span class="dv">15</span>,</div>
<div class="sourceLine" id="cb36-6" data-line-number="6">     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">85</span>), <span class="dt">ylim  =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">col =</span> <span class="st">"red"</span>,</div>
<div class="sourceLine" id="cb36-7" data-line-number="7">     <span class="dt">xlab =</span> <span class="st">"Federalist Papers"</span>, <span class="dt">ylab =</span> <span class="st">"Predicted values"</span>)</div>
<div class="sourceLine" id="cb36-8" data-line-number="8">
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="st">"dashed"</span>)</div>
<div class="sourceLine" id="cb36-9" data-line-number="9"></div>
<div class="sourceLine" id="cb36-10" data-line-number="10"><span class="co"># essays authored by Madison; blue circles</span></div>
<div class="sourceLine" id="cb36-11" data-line-number="11">
<span class="kw">points</span>(madison, hm_fitted[author_data<span class="op">$</span>author <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>],</div>
<div class="sourceLine" id="cb36-12" data-line-number="12">       <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)</div>
<div class="sourceLine" id="cb36-13" data-line-number="13"><span class="co"># disputed authorship; black triangles</span></div>
<div class="sourceLine" id="cb36-14" data-line-number="14">
<span class="kw">points</span>(disputed, pred, <span class="dt">pch =</span> <span class="dv">17</span>)</div></code></pre>
<p><img src="qss_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#download-the-corpus">Download the corpus</a></li>
      <li><a href="#section-5-1-1-the-disputed-authorship-of-the-federalist-papers">Section 5.1.1: The Disputed Authorship of ‘The Federalist Papers’</a></li>
      <li><a href="#section-5-1-2-document-term-matrix">Section 5.1.2: Document-Term Matrix</a></li>
      <li><a href="#section-5-1-3-topic-discovery">Section 5.1.3: Topic Discovery</a></li>
      <li><a href="#section-5-1-4-authorship-prediction">Section 5.1.4: Authorship Prediction</a></li>
      <li><a href="#section-5-1-5-cross-validation">Section 5.1.5: Cross-Validation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kenneth Benoit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
